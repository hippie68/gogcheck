#!/bin/bash

filecount=0
errorcount=0
errorfiles=""
red='\e[91m'
green='\e[92m'
purple='\e[95m'
reset='\e[39m'

[[ "$1" == "" ]] && set -- .

function inno {
  innoerror=false
  ((filecount++))
  echo -e "Testing ${purple}$1${reset}"
  innoextract --gog --test --silent --progress=1 "$1"
  if [[ "$?" != "0" ]]; then
    ((errorcount++))
    errorfiles+="$1
"
    echo -e "  ${red}Encountered errors${reset}."
  fi
}

while [[ "$1" != "" ]]; do
  [[ -d "$1" ]] && for exe in "$1"/*.exe; do [[ -f "$exe" ]] && inno "$exe"; done
  [[ -f "$1" ]] && inno "$1"
  shift
done

echo -n "$filecount exe file(s), "
if [[ $errorcount == 0 ]]; then echo -en "${green}"; else echo -en "${red}"; fi
echo -e "$errorcount error(s)${reset}"
if [[ $errorcount -gt 0 ]]; then
  echo "Listing files with errors:"
  echo -e "${red}$errorfiles${reset}"
fi
exit "$errorcount"
